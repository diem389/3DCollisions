
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Picking Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="other_structures.html" />
    
    
    <link rel="prev" href="raycast.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Chapter0/">
            
                <a href="../Chapter0/">
            
                    
                    New Repo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../Chapter0/application.html">
            
                <a href="../Chapter0/application.html">
            
                    
                    Applicaiton.cs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../Chapter0/program.html">
            
                <a href="../Chapter0/program.html">
            
                    
                    Program.cs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../Chapter0/samples.html">
            
                <a href="../Chapter0/samples.html">
            
                    
                    Samples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../Chapter0/console.html">
            
                <a href="../Chapter0/console.html">
            
                    
                    Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../Chapter0/window.html">
            
                <a href="../Chapter0/window.html">
            
                    
                    Windowed
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Chapter1/">
            
                <a href="../Chapter1/">
            
                    
                    Shapes And Points
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Chapter1/point.html">
            
                <a href="../Chapter1/point.html">
            
                    
                    Point
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Chapter1/sphere.html">
            
                <a href="../Chapter1/sphere.html">
            
                    
                    Sphere
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../Chapter1/point_in_sphere.html">
            
                <a href="../Chapter1/point_in_sphere.html">
            
                    
                    Point in Sphere
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../Chapter1/closest_point_sphere.html">
            
                <a href="../Chapter1/closest_point_sphere.html">
            
                    
                    Closest point on Sphere
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Chapter1/aabb.html">
            
                <a href="../Chapter1/aabb.html">
            
                    
                    AABB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../Chapter1/point_in_aabb.html">
            
                <a href="../Chapter1/point_in_aabb.html">
            
                    
                    Point in AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../Chapter1/closest_point_aabb.html">
            
                <a href="../Chapter1/closest_point_aabb.html">
            
                    
                    Closest point on AABB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../Chapter1/plane.html">
            
                <a href="../Chapter1/plane.html">
            
                    
                    Plane
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../Chapter1/point_on_plane.html">
            
                <a href="../Chapter1/point_on_plane.html">
            
                    
                    Point on Plane
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../Chapter1/closest_point_on_plane.html">
            
                <a href="../Chapter1/closest_point_on_plane.html">
            
                    
                    Closest point on Plane
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../Chapter1/three_plane_intersection.html">
            
                <a href="../Chapter1/three_plane_intersection.html">
            
                    
                    3 Plane Intersection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../Chapter1/line.html">
            
                <a href="../Chapter1/line.html">
            
                    
                    Line
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="../Chapter1/point_on_line.html">
            
                <a href="../Chapter1/point_on_line.html">
            
                    
                    Point on line
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="../Chapter1/closest_point_on_line.html">
            
                <a href="../Chapter1/closest_point_on_line.html">
            
                    
                    Closes point on Line
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../Chapter1/ray.html">
            
                <a href="../Chapter1/ray.html">
            
                    
                    Ray
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1" data-path="../Chapter1/point_on_ray.html">
            
                <a href="../Chapter1/point_on_ray.html">
            
                    
                    Point on ray
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.2" data-path="../Chapter1/closest_point_on_ray.html">
            
                <a href="../Chapter1/closest_point_on_ray.html">
            
                    
                    Closest point on Ray
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Intermission0/">
            
                <a href="../Intermission0/">
            
                    
                    Intermission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Chapter2/">
            
                <a href="../Chapter2/">
            
                    
                    Static Intersections
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Chapter2/static_sphere_sphere.html">
            
                <a href="../Chapter2/static_sphere_sphere.html">
            
                    
                    Sphere-Sphere
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../Chapter2/static_sphere_aabb.html">
            
                <a href="../Chapter2/static_sphere_aabb.html">
            
                    
                    Sphere-AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../Chapter2/static_sphere_plane.html">
            
                <a href="../Chapter2/static_sphere_plane.html">
            
                    
                    Sphere-Plane
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../Chapter2/static_aabb_aabb.html">
            
                <a href="../Chapter2/static_aabb_aabb.html">
            
                    
                    AABB-AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../Chapter2/static_aabb_plane.html">
            
                <a href="../Chapter2/static_aabb_plane.html">
            
                    
                    AABB-Plane
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../Chapter2/static_plane_plane.html">
            
                <a href="../Chapter2/static_plane_plane.html">
            
                    
                    Plane-Plane
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../Chapter3/">
            
                <a href="../Chapter3/">
            
                    
                    Lines and Rays
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../Chapter3/raycasting.html">
            
                <a href="../Chapter3/raycasting.html">
            
                    
                    Ray casting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../Chapter3/raycast_sphere.html">
            
                <a href="../Chapter3/raycast_sphere.html">
            
                    
                    Against Sphere
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../Chapter3/raycast_aabb.html">
            
                <a href="../Chapter3/raycast_aabb.html">
            
                    
                    Against AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../Chapter3/raycast_plane.html">
            
                <a href="../Chapter3/raycast_plane.html">
            
                    
                    Against Plane
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../Chapter3/linetesting.html">
            
                <a href="../Chapter3/linetesting.html">
            
                    
                    Line testing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../Chapter3/line_sphere.html">
            
                <a href="../Chapter3/line_sphere.html">
            
                    
                    Against Sphere
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="../Chapter3/line_aabb.html">
            
                <a href="../Chapter3/line_aabb.html">
            
                    
                    Against AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="../Chapter3/line_plane.html">
            
                <a href="../Chapter3/line_plane.html">
            
                    
                    Against Plane
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../Chapter2/dynamic.html">
            
                <a href="../Chapter2/dynamic.html">
            
                    
                    Dynamic Intersections
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../Chapter2/dynamic_aabb_aabb.html">
            
                <a href="../Chapter2/dynamic_aabb_aabb.html">
            
                    
                    Time Slicing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../Chapter2/dynamic_sphere_sphere.html">
            
                <a href="../Chapter2/dynamic_sphere_sphere.html">
            
                    
                    Linear Impact Search
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../Chapter2/dynamic_sphere_aabb.html">
            
                <a href="../Chapter2/dynamic_sphere_aabb.html">
            
                    
                    Binary Impact Search
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../Chapter2/dynamic_sphere_plane.html">
            
                <a href="../Chapter2/dynamic_sphere_plane.html">
            
                    
                    Multiple Moving Objects
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../Chapter4/">
            
                <a href="../Chapter4/">
            
                    
                    3D Models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../Chapter4/triangle.html">
            
                <a href="../Chapter4/triangle.html">
            
                    
                    Triangle
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../Chapter4/point_in_triangle.html">
            
                <a href="../Chapter4/point_in_triangle.html">
            
                    
                    Point in Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="../Chapter4/closest_point_to_triangle.html">
            
                <a href="../Chapter4/closest_point_to_triangle.html">
            
                    
                    Closest point to triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.3" data-path="../Chapter4/sphere_to_triangle.html">
            
                <a href="../Chapter4/sphere_to_triangle.html">
            
                    
                    Sphere-Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.4" data-path="../Chapter4/aabb-triangle.html">
            
                <a href="../Chapter4/aabb-triangle.html">
            
                    
                    AABB-Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.5" data-path="../Chapter4/plane-triangle.html">
            
                <a href="../Chapter4/plane-triangle.html">
            
                    
                    Plane-Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.6" data-path="../Chapter4/generic_sat.html">
            
                <a href="../Chapter4/generic_sat.html">
            
                    
                    Generic SAT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.7" data-path="../Chapter4/triangle-triangle.html">
            
                <a href="../Chapter4/triangle-triangle.html">
            
                    
                    Triangle-Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.8" data-path="../Chapter4/robust_sat.html">
            
                <a href="../Chapter4/robust_sat.html">
            
                    
                    Robust SAT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.9" data-path="../Chapter4/raycast_triangle.html">
            
                <a href="../Chapter4/raycast_triangle.html">
            
                    
                    Raycast Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.10" data-path="../Chapter4/line_test_triangle.html">
            
                <a href="../Chapter4/line_test_triangle.html">
            
                    
                    Line test Triangle
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../Chapter4/containers.html">
            
                <a href="../Chapter4/containers.html">
            
                    
                    Broad-Phase Collision
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../Chapter4/addingtriangles_to_model_md.html">
            
                <a href="../Chapter4/addingtriangles_to_model_md.html">
            
                    
                    Adding Triangles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="../Chapter4/aabb.html">
            
                <a href="../Chapter4/aabb.html">
            
                    
                    AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="../Chapter4/sphere.html">
            
                <a href="../Chapter4/sphere.html">
            
                    
                    Sphere
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../Chapter4/model_test.html">
            
                <a href="../Chapter4/model_test.html">
            
                    
                    Collision Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.3.1" data-path="../Chapter4/model_test_sphere.html">
            
                <a href="../Chapter4/model_test_sphere.html">
            
                    
                    Sphere
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.2" data-path="../Chapter4/m_test_aabb.html">
            
                <a href="../Chapter4/m_test_aabb.html">
            
                    
                    AABB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.3" data-path="../Chapter4/model_test_plane.html">
            
                <a href="../Chapter4/model_test_plane.html">
            
                    
                    Plane
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.4" data-path="../Chapter4/model_test_triangle.html">
            
                <a href="../Chapter4/model_test_triangle.html">
            
                    
                    Triangle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.5" data-path="../Chapter4/model_test_ray.html">
            
                <a href="../Chapter4/model_test_ray.html">
            
                    
                    Ray
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../Chapter4/raycast_model.html">
            
                <a href="../Chapter4/raycast_model.html">
            
                    
                    Raycast Model
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../Chapter4/bvh.html">
            
                <a href="../Chapter4/bvh.html">
            
                    
                    BVH - Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="../Chapter4/bvh_split.html">
            
                <a href="../Chapter4/bvh_split.html">
            
                    
                    BVH - Split
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="../Chapter4/bch_shake.html">
            
                <a href="../Chapter4/bch_shake.html">
            
                    
                    BVH - Shake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="../Chapter4/bvh_raycast.html">
            
                <a href="../Chapter4/bvh_raycast.html">
            
                    
                    BVH - Raycast
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="./">
            
                <a href="./">
            
                    
                    Scene Management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="hierarchy.html">
            
                <a href="hierarchy.html">
            
                    
                    Hierarchy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="make_a_scene.html">
            
                <a href="make_a_scene.html">
            
                    
                    Making a scene
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="octree.html">
            
                <a href="octree.html">
            
                    
                    Octree
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="dynamic_objects.html">
            
                <a href="dynamic_objects.html">
            
                    
                    Octree-Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="raycast.html">
            
                <a href="raycast.html">
            
                    
                    Raycast
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.9.4" data-path="picking.html">
            
                <a href="picking.html">
            
                    
                    Picking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="other_structures.html">
            
                <a href="other_structures.html">
            
                    
                    Other structures
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../Chapter6/">
            
                <a href="../Chapter6/">
            
                    
                    Camera
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../Chapter6/debug_info.html">
            
                <a href="../Chapter6/debug_info.html">
            
                    
                    Debug Info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../Chapter6/frustum.html">
            
                <a href="../Chapter6/frustum.html">
            
                    
                    Frustum
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="../Chapter6/point_in_frustum.html">
            
                <a href="../Chapter6/point_in_frustum.html">
            
                    
                    Point in Frustum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="../Chapter6/sphere_in_frustum.html">
            
                <a href="../Chapter6/sphere_in_frustum.html">
            
                    
                    Sphere in Frustum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3" data-path="../Chapter6/aabb_in_frustum.html">
            
                <a href="../Chapter6/aabb_in_frustum.html">
            
                    
                    AABB in Frustum
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../Chapter6/culling.html">
            
                <a href="../Chapter6/culling.html">
            
                    
                    Culling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../Chapter7/">
            
                <a href="../Chapter7/">
            
                    
                    Further Research
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../Chapter7/obb.html">
            
                <a href="../Chapter7/obb.html">
            
                    
                    OBB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../Chapter7/capsule.html">
            
                <a href="../Chapter7/capsule.html">
            
                    
                    Capsule
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../Chapter7/elipsoid.html">
            
                <a href="../Chapter7/elipsoid.html">
            
                    
                    Elipsoid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../Chapter7/cylinder.html">
            
                <a href="../Chapter7/cylinder.html">
            
                    
                    Cylinder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../Chapter7/engines.html">
            
                <a href="../Chapter7/engines.html">
            
                    
                    Physics Engines
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Picking</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="picking">Picking</h1>
<p>Object picking is one of those problems that&apos;s fairly easy to solve, but for some reason no one ever knows how. What is picking? Click on a 3D scene, and the object you click on gets selected. So how to we accompolish this?</p>
<p>The user clicks on the screen. We find the pixel they selected on the near and far clip planes of the view frustum. We use these two points to construct a ray, then we do a raycast into the world using this ray. Whatever object collides with the ray (and has the lowest t value) is the object the user clicked on!</p>
<p><img src="image008.jpg" alt="IM8"></p>
<p>The entire point of the OpenGL graphics pipeline is to take a world-space point and transform it to screen space coordinates. This is done using a variety of matrix multiplications. For picking we have to do the reverse! We have to take a screen space point and apply the reverse of the graphics pipeline to get two world space points.</p>
<p>Going from world space to screen space (What openGL does) is called <strong>Projection</strong>. Going from screen space to world space (What we need to do) is <strong>Un-Projection</strong>. Let&apos;s take a look at the projection pipeline:</p>
<p><img src="Image49.gif" alt="IM49"></p>
<h2 id="un-project">Un-project</h2>
<p>It&apos;s time to implement an &quot;Unproject&quot; function. I&apos;m adding this to my <strong>Matrix4.cs</strong> file, as it is a matrix function.</p>
<p>The unproject function takes 4 arguments. The first one is a <code>Vector3</code> that is the screen space position of the mouse. Of course, screen space mouse only has an X and a Y coordiante! What is Z used for? Z represents WHERE in space we want to get the unprojected point. A Z of 0 is the near clip plane of the camera. A Z of 1 is the far clip plane of the camera.</p>
<p>Next up, we take the current view and projection matrices. These are self explanatory. Finally, we take a 4 component float array that is the screen viewport. It holds the x, y, width and height of the viewport, relative to the game window. We need this to be able to normalize the mouse screen coords.</p>
<p>The actual unproject pipeline works like this:</p>
<ol>
<li>Normalize screen space X and Y<ul>
<li>Simply divide the offset X and Y by screen Width and height </li>
</ul>
</li>
<li>Transform the normalized vector into NDC Space<ul>
<li>NDC space is -1 to 1, not 0 to 1 like normalized space. </li>
</ul>
</li>
<li>Transform the NDC space vector into eye / view space<ul>
<li>Multiply by the inverse of the projection matrix.</li>
<li>This will leave the inverse perspectiv divide in the W component</li>
<li>Remember, eye space is the world as if the camera was at it&apos;s center</li>
</ul>
</li>
<li>Transform the eye space vector into world space<ul>
<li>Multiply by the inverse of the modelView matrix</li>
<li>This will leave the point in proper world space</li>
<li>The W component from step 3 remains unchanged</li>
</ul>
</li>
<li>Compensate for perspective division<ul>
<li>Diide the X, Y and Z components by the W component acquired in step 3 </li>
</ul>
</li>
</ol>
<p>I&apos;ll provide the basic implementation here</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Vector3 <span class="hljs-title">UnProject</span>(<span class="hljs-params">Vector3 windowCoords, Matrix4 modelView, Matrix4 projection, <span class="hljs-keyword">float</span>[] viewPort</span>) </span>{
    <span class="hljs-comment">// First, convert from window coordinates to NDC coordinates</span>
    Vector4 ndcCoords = <span class="hljs-keyword">new</span> Vector4(windowCoords.X, windowCoords.Y, windowCoords.Z, <span class="hljs-number">1.0</span>f);
    ndcCoords.X = (ndcCoords.X - viewPort[<span class="hljs-number">0</span>]) / viewPort[<span class="hljs-number">2</span>]; <span class="hljs-comment">// Range 0 to 1: (windowX - viewX) / viewWidth</span>
    ndcCoords.Y = (ndcCoords.Y - viewPort[<span class="hljs-number">1</span>]) / viewPort[<span class="hljs-number">3</span>]; <span class="hljs-comment">// Range 0 to 1: (windowY - viewY) / viewHeight</span>
    <span class="hljs-comment">// Remember, NDC ranges from -1 to 1, not 0 to 1</span>
    ndcCoords.X = ndcCoords.X * <span class="hljs-number">2</span>f - <span class="hljs-number">1</span>f; <span class="hljs-comment">// Range: -1 to 1</span>
    ndcCoords.Y = <span class="hljs-number">1</span>f - ndcCoords.Y * <span class="hljs-number">2</span>f; <span class="hljs-comment">// Range: -1 to 1 - Flipped!</span>
    ndcCoords.Z = ndcCoords.Z * <span class="hljs-number">2</span>f - <span class="hljs-number">1</span>f; <span class="hljs-comment">// Range: -1 to 1</span>

    <span class="hljs-comment">// Next, from NDC space to eye / view space.</span>
    <span class="hljs-comment">// We get here by multiplying the inverse of the projection matrix</span>
    <span class="hljs-comment">// by NDC coords. Note, this leaves a scalar in the W component!</span>
    Vector4 eyeCoords = Matrix4.Inverse(projection) * ndcCoords;

    <span class="hljs-comment">// Next, from eye space to world space.</span>
    <span class="hljs-comment">// Remember, eye space assumes the camera is at the center of the world,</span>
    <span class="hljs-comment">// this is not the case, let&apos;s move the actual point into world space</span>
    Vector4 worldCoords = Matrix4.Inverse(modelView) * eyeCoords;

    <span class="hljs-comment">// Finally, undo the perspective divide!</span>
    <span class="hljs-comment">// When we multiplied by the inverse of the projection matrix, that</span>
    <span class="hljs-comment">// multiplication left the inverse of the perspective divide in the </span>
    <span class="hljs-comment">// W component of the resulting vector. This could be 0</span>
    <span class="hljs-keyword">if</span> (Math.Abs(<span class="hljs-number">0.0</span>f - worldCoords.W) &gt; <span class="hljs-number">0.00001</span>f) {
        <span class="hljs-comment">// This is the same as dividing every component by W</span>
        worldCoords *= <span class="hljs-number">1.0</span>f / worldCoords.W;
    }

    <span class="hljs-comment">// Now we have a proper 4D vector with a W of 1 (or 0)</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Vector3(worldCoords.X, worldCoords.Y, worldCoords.Z);
}
</code></pre>
<h3 id="unit-test">Unit test</h3>
<p>We&apos;re going to implement a unit test that will show you how to unproject a point. Unlike previous unit tests, we will talk about excerpts of code in this one after the test is written.</p>
<p>Move your mouse around the screen, when it is over the cube being rendered, a red sphere should render in world space representing WHERE on the cube your mouse is:</p>
<p><img src="unproject_unit_test.png" alt="UnProject"></p>
<p>Before we implement the unit test, i want to change the <code>Render</code> function of the <code>Scene</code> class to take a bool. This bool will determine if debug geometry is rendered or not.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> debug</span>) </span>{
    RootObject.Render();
    <span class="hljs-keyword">if</span> (debug) {
        GL.Disable(EnableCap.Lighting);
        GL.PolygonMode(MaterialFace.FrontAndBack, PolygonMode.Line);
        Octree.DebugRender();
        GL.PolygonMode(MaterialFace.FrontAndBack, PolygonMode.Fill);
        Octree.DebugRenderOnlyVisitedNodes();
        GL.Enable(EnableCap.Lighting);
    }
}
</code></pre>
<p>Now, onto the actual unit!</p>
<pre><code class="lang-cs"><span class="hljs-keyword">using</span> OpenTK.Graphics.OpenGL;
<span class="hljs-keyword">using</span> Math_Implementation;
<span class="hljs-keyword">using</span> CollisionDetectionSelector.Primitives;
<span class="hljs-keyword">using</span> CollisionDetectionSelector;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">CollisionDetectionSelector.Samples</span> {
    <span class="hljs-keyword">class</span> <span class="hljs-title">SceneSample04</span> : <span class="hljs-title">Application</span> {
        Scene scene = <span class="hljs-keyword">new</span> Scene();

        OBJLoader cube = <span class="hljs-keyword">null</span>;

        Sphere debugSphere = <span class="hljs-keyword">new</span> Sphere(<span class="hljs-keyword">new</span> Point(), <span class="hljs-number">0.5</span>f);
        Ray debugRay = <span class="hljs-keyword">new</span> Ray();
        AABB debugBox = <span class="hljs-keyword">null</span>; 

        Matrix4 modelView = <span class="hljs-keyword">new</span> Matrix4();
        Matrix4 projection = <span class="hljs-keyword">new</span> Matrix4();
        <span class="hljs-keyword">float</span>[] viewport = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[<span class="hljs-number">4</span>];

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Intialize</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height</span>) </span>{
            GL.Enable(EnableCap.DepthTest);
            GL.Enable(EnableCap.Lighting);
            GL.Enable(EnableCap.Light0);
            GL.PointSize(<span class="hljs-number">5</span>f);

            GL.Light(LightName.Light0, LightParameter.Position, <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[] { <span class="hljs-number">0.5</span>f, <span class="hljs-number">-0.5</span>f, <span class="hljs-number">0.5</span>f, <span class="hljs-number">0.0</span>f });
            GL.Light(LightName.Light0, LightParameter.Ambient, <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[] { <span class="hljs-number">0</span>f, <span class="hljs-number">1</span>f, <span class="hljs-number">0</span>f, <span class="hljs-number">1</span>f });
            GL.Light(LightName.Light0, LightParameter.Diffuse, <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[] { <span class="hljs-number">0</span>f, <span class="hljs-number">1</span>f, <span class="hljs-number">0</span>f, <span class="hljs-number">1</span>f });
            GL.Light(LightName.Light0, LightParameter.Specular, <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[] { <span class="hljs-number">1</span>f, <span class="hljs-number">1</span>f, <span class="hljs-number">1</span>f, <span class="hljs-number">1</span>f });

            scene.Initialize(<span class="hljs-number">7</span>f);

            cube = <span class="hljs-keyword">new</span> OBJLoader(<span class="hljs-string">&quot;Assets/cube.obj&quot;</span>);

            <span class="hljs-comment">// Because the debug AABB we are actually using for picking has no lighting</span>
            <span class="hljs-comment">// let&apos;s actually render an OBJ in the exact position of it!</span>
            scene.RootObject.Children.Add(<span class="hljs-keyword">new</span> OBJ(cube));
            scene.RootObject.Children[<span class="hljs-number">0</span>].Parent = scene.RootObject;
            scene.RootObject.Children[<span class="hljs-number">0</span>].Position = <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">3</span>f, <span class="hljs-number">-7</span>f, <span class="hljs-number">-1</span>f);
            scene.RootObject.Children[<span class="hljs-number">0</span>].Scale = <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">7</span>f, <span class="hljs-number">5</span>f, <span class="hljs-number">4</span>f);

            <span class="hljs-comment">// Gotta set the World space points of the debug AABB</span>
            <span class="hljs-comment">// to the same thing as the visual node!</span>
            Matrix4 world = scene.RootObject.Children[<span class="hljs-number">0</span>].WorldMatrix;
            debugBox = scene.RootObject.Children[<span class="hljs-number">0</span>].BoundingBox; <span class="hljs-comment">// TEMP</span>
            Vector3 newMin = Matrix4.MultiplyPoint(world, debugBox.Min.ToVector());
            Vector3 newMax = Matrix4.MultiplyPoint(world, debugBox.Max.ToVector());
            <span class="hljs-comment">// Construct the final collision box</span>
            debugBox = <span class="hljs-keyword">new</span> AABB(<span class="hljs-keyword">new</span> Point(newMin), <span class="hljs-keyword">new</span> Point(newMax));
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">base</span>.Render();
            DrawOrigin();

            GL.Enable(EnableCap.Lighting);
            scene.Render(<span class="hljs-keyword">false</span>);
            GL.Disable(EnableCap.Lighting);

            <span class="hljs-keyword">float</span>[] rawModelView = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[<span class="hljs-number">16</span>];
            GL.GetFloat(GetPName.ModelviewMatrix, rawModelView);

            <span class="hljs-keyword">float</span>[] rawProjection = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[<span class="hljs-number">16</span>];
            GL.GetFloat(GetPName.ProjectionMatrix, rawProjection);

            GL.GetFloat(GetPName.Viewport, viewport);

            modelView = Matrix4.Transpose(<span class="hljs-keyword">new</span> Matrix4(rawModelView));
            projection = Matrix4.Transpose(<span class="hljs-keyword">new</span> Matrix4(rawProjection));

            GL.Color3(<span class="hljs-number">1</span>f, <span class="hljs-number">0</span>f, <span class="hljs-number">0</span>f);
            debugSphere.Render();
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>) </span>{
            <span class="hljs-comment">// Don&apos;t rotate the scene</span>
            <span class="hljs-comment">//base.Update(deltaTime);</span>

            <span class="hljs-keyword">float</span>[] viewport = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[] { <span class="hljs-number">0</span>f, <span class="hljs-number">0</span>f, Window.Width, Window.Height };

            Vector3 near = Matrix4.UnProject(<span class="hljs-keyword">new</span> Vector3(Window.Mouse.X, Window.Mouse.Y, <span class="hljs-number">0.0</span>f), modelView, projection, viewport);
            Vector3 far = Matrix4.UnProject(<span class="hljs-keyword">new</span> Vector3(Window.Mouse.X, Window.Mouse.Y, <span class="hljs-number">1.0</span>f), modelView, projection, viewport);

            debugRay = <span class="hljs-keyword">new</span> Ray(near, Vector3.Normalize(far - near));
            Point p = <span class="hljs-keyword">new</span> Point();
            <span class="hljs-keyword">if</span> (Collisions.Raycast(debugRay, debugBox, <span class="hljs-keyword">out</span> p)) {
                debugSphere.Position = p;
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// Off-screen</span>
                debugSphere.Position = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">-5000</span>, <span class="hljs-number">-5000</span>, <span class="hljs-number">-5000</span>);
            }
        }
    }
}
</code></pre>
<h3 id="things-to-note">Things to note</h3>
<p>In the above example we store the Projection matrix, ModelView matrix and Viewport as member variables:</p>
<pre><code class="lang-cs">Matrix4 modelView = <span class="hljs-keyword">new</span> Matrix4();
Matrix4 projection = <span class="hljs-keyword">new</span> Matrix4();
<span class="hljs-keyword">float</span>[] viewport = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[<span class="hljs-number">4</span>];
</code></pre>
<p>This is because we use them in the <code>Update</code> function, but we can only retrieve their values in the <code>Render</code> function. This is how we get data from one function into the other. Let&apos;s take a quick look at how they are retrieved:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">float</span>[] rawModelView = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[<span class="hljs-number">16</span>];
GL.GetFloat(GetPName.ModelviewMatrix, rawModelView);

<span class="hljs-keyword">float</span>[] rawProjection = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[<span class="hljs-number">16</span>];
GL.GetFloat(GetPName.ProjectionMatrix, rawProjection);

GL.GetFloat(GetPName.Viewport, viewport);

modelView = Matrix4.Transpose(<span class="hljs-keyword">new</span> Matrix4(rawModelView));
projection = Matrix4.Transpose(<span class="hljs-keyword">new</span> Matrix4(rawProjection));
</code></pre>
<p>The <code>GL.GetFloat</code> method can be used to retrieve indevidual floating point values or entire arrays! The matrices are pretty self explanatory. Remember, our matrices are row major, openGL&apos;s matrices are column major. We therefore need to transpose any returned matrix.</p>
<p>The viewport might seem like a bit of black magic, considering we don&apos;t set it that often, but in reality it&apos;s set every time the game is resized. We just so happened to implement a helper function in the base <code>Application</code> class to do it for us. Just to avoid repetative typing. That&apos;s the retrieved viewport.</p>
<p>Finally, it&apos;s worth noting, we use an overload of raycast that returns a point, not t. If we just had t we could still find the point like so:</p>
<pre><code class="lang-cs">Point hitPoint = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">float</span> t = <span class="hljs-number">-1</span>;
<span class="hljs-keyword">bool</span> result = Raycast(ray, aabb, <span class="hljs-keyword">out</span> t);
<span class="hljs-keyword">if</span> (raycast) {
    hitPoint = <span class="hljs-keyword">new</span> Point(ray.Position + ray.Normal * t);
}
<span class="hljs-keyword">else</span> { <span class="hljs-comment">// Not hit, ofscreen?</span>
    hitPoint = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">-5000</span>, <span class="hljs-number">-5000</span>, <span class="hljs-number">-5000</span>);
}
</code></pre>
<p>The rest of the code should be self-explanatory. The only thing that might be confusing in there is why we don&apos;t render <code>debugBox</code>, it&apos;s because <code>AABB</code>&apos;s that we render have no normal. For the sample to look good we need geometry with normals. So, i just added a box to the root of the scene that&apos;s at the same position as the AABB we are raycasting against.</p>
<p>Note, this raycast did not go trough the Octree, adding support for octree-based picking is a fairly trivial task.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="raycast.html" class="navigation navigation-prev " aria-label="Previous page: Raycast">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="other_structures.html" class="navigation navigation-next " aria-label="Next page: Other structures">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Picking","level":"1.9.4","depth":2,"next":{"title":"Other structures","level":"1.9.5","depth":2,"path":"Chapter5/other_structures.md","ref":"Chapter5/other_structures.md","articles":[]},"previous":{"title":"Raycast","level":"1.9.3.2","depth":3,"path":"Chapter5/raycast.md","ref":"Chapter5/raycast.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["mathjax","youtube"],"pluginsConfig":{"mathjax":{"forceSVG":false,"version":"2.6-latest"},"youtube":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"letter","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Chapter5/picking.md","mtime":"2016-08-09T17:10:53.812Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-10-03T17:51:33.268Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

